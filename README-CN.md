# C2Rust Agent

åŸºäºå¤§è¯­è¨€æ¨¡å‹çš„æ™ºèƒ½Cé¡¹ç›®åˆ°Rusté¡¹ç›®è½¬æ¢å·¥å…·

[![Rust](https://img.shields.io/badge/rust-1.70+-orange.svg)](https://www.rust-lang.org)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Build Status](https://img.shields.io/badge/build-passing-brightgreen.svg)]()

## é¡¹ç›®æ¦‚è¿°

C2Rust Agent æ˜¯ä¸€ä¸ªå…ˆè¿›çš„ä»£ç ç¿»è¯‘ç³»ç»Ÿï¼Œåˆ©ç”¨å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰å°†Cé¡¹ç›®è½¬æ¢ä¸ºå®‰å…¨ã€æƒ¯ç”¨çš„Rustä»£ç ã€‚ä¸ç®€å•çš„è½¬è¯‘å™¨ä¸åŒï¼Œè¯¥å·¥å…·èƒ½å¤Ÿç†è§£ä»£ç è¯­ä¹‰å¹¶ç”Ÿæˆäººç±»å¯è¯»ã€å¯ç»´æŠ¤çš„Rustä»£ç ï¼Œéµå¾ªæœ€ä½³å®è·µã€‚

## æ ¸å¿ƒç‰¹æ€§

- **æ™ºèƒ½ç¿»è¯‘**: ä½¿ç”¨LLMç†è§£Cä»£ç è¯­ä¹‰ï¼Œç”Ÿæˆæƒ¯ç”¨çš„Rustä»£ç 
- **é¡¹ç›®çº§åˆ†æ**: å¤„ç†æ•´ä¸ªCé¡¹ç›®ï¼Œä¿æŒç»“æ„å’Œå…³ç³»
- **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**: åˆ©ç”¨æ•°æ®åº“å­˜å‚¨çš„ä»£ç å…³ç³»æé«˜ç¿»è¯‘è´¨é‡
- **è¿­ä»£ä¼˜åŒ–**: åŸºäºé”™è¯¯åé¦ˆè‡ªåŠ¨é‡è¯•ç¿»è¯‘ï¼Œç›´åˆ°ä»£ç èƒ½å¤Ÿç¼–è¯‘
- **å¤šç§é¡¹ç›®ç±»å‹**: æ”¯æŒå•æ–‡ä»¶ã€é…å¯¹å¤´æ–‡ä»¶/æºæ–‡ä»¶å’Œå¤šæ¨¡å—é¡¹ç›®
- **LSPé›†æˆ**: æä¾›è¯­è¨€æœåŠ¡å™¨åè®®æ”¯æŒï¼Œä¾¿äºIDEé›†æˆ
- **æ•°æ®åº“åç«¯**: å­˜å‚¨ä»£ç åˆ†æå’Œç¿»è¯‘å†å²

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Cé¡¹ç›®åˆ†æ     â”‚â”€â”€â”€â–¶â”‚   LSPæœåŠ¡       â”‚â”€â”€â”€â–¶â”‚   æ•°æ®åº“å­˜å‚¨    â”‚
â”‚                 â”‚    â”‚  (ä»£ç ç´¢å¼•)     â”‚    â”‚(SQLite+Qdrant) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                              â”‚
         â–¼                                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é¢„å¤„ç†å™¨      â”‚â”€â”€â”€â–¶â”‚   ä¸»å¤„ç†å™¨      â”‚â—€â”€â”€â”€â”‚  æç¤ºæ„å»ºå™¨     â”‚
â”‚  (ç¼“å­˜&æ˜ å°„)    â”‚    â”‚  (ç¿»è¯‘åè°ƒ)     â”‚    â”‚  (ä¸Šä¸‹æ–‡ç”Ÿæˆ)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚
         â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ–‡ä»¶æ‰«æå™¨    â”‚    â”‚   LLMæœåŠ¡       â”‚
â”‚  (é¡¹ç›®å‘ç°)     â”‚    â”‚  (ä»£ç ç¿»è¯‘)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  Rustæ£€æŸ¥å™¨     â”‚
                     â”‚  (ä»£ç éªŒè¯)     â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

- **LSPæœåŠ¡**: åˆ†æCä»£ç ç»“æ„å’Œå…³ç³»
- **æ•°æ®åº“æœåŠ¡**: åœ¨SQLite + Qdrantå‘é‡æ•°æ®åº“ä¸­å­˜å‚¨ä»£ç åˆ†æ
- **é¢„å¤„ç†å™¨**: ç”Ÿæˆç¼“å­˜å’Œæ–‡ä»¶æ˜ å°„ï¼Œæ‹†åˆ†ä¸ºç¼–è¯‘å•å…ƒ
- **ä¸»å¤„ç†å™¨**: åè°ƒç¿»è¯‘å·¥ä½œæµç¨‹ï¼ŒåŒ…å«é‡è¯•é€»è¾‘
- **æç¤ºæ„å»ºå™¨**: ä¸ºLLMç¿»è¯‘ç”Ÿæˆä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„æç¤º
- **LLMè¯·æ±‚å™¨**: ä¸è¯­è¨€æ¨¡å‹æ¥å£è¿›è¡Œä»£ç ç¿»è¯‘
- **Rustæ£€æŸ¥å™¨**: éªŒè¯ç”Ÿæˆçš„Rustä»£ç ç¼–è¯‘

## å®‰è£…æŒ‡å—

### ç³»ç»Ÿè¦æ±‚

1. **Rustç¼–ç¨‹è¯­è¨€**: ä» [rustup.rs](https://rustup.rs/) å®‰è£…
   ```bash
   curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
   ```

2. **Qdrantå‘é‡æ•°æ®åº“**: ç”¨äºè¯­ä¹‰ä»£ç æœç´¢
   ```bash
   # ä½¿ç”¨Docker
   docker run -p 6333:6333 qdrant/qdrant
   
   # æˆ–æœ¬åœ°å®‰è£…
   # å‚è§: https://qdrant.tech/documentation/guides/installation/
   ```

3. **LLM APIè®¿é—®**: é…ç½®OpenAI GPTã€Claudeæˆ–å…¶ä»–å…¼å®¹æ¨¡å‹çš„è®¿é—®

### æºç æ„å»º

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/rust4c/c2rust_agent.git
cd c2rust_agent

# æ„å»ºæ‰€æœ‰ç»„ä»¶
cargo build --release

# è¿è¡Œæµ‹è¯•
cargo test
```

## é…ç½®

åˆ›å»º `config/config.toml`:

```toml
[database]
sqlite_path = "data/c2rust.db"
qdrant_url = "http://localhost:6333"

[llm]
provider = "openai"  # æˆ– "claude", "local"
api_key = "your-api-key-here"
model = "gpt-4"

[translation]
max_retries = 3
concurrent_limit = 4
cache_dir = "cache"

[logging]
level = "info"
file = "logs/c2rust.log"
```

## ä½¿ç”¨æ–¹æ³•

### å‘½ä»¤è¡Œç•Œé¢

```bash
# åˆ†æå¹¶ç¿»è¯‘Cé¡¹ç›®
c2rust-agent translate /path/to/c/project --output /path/to/rust/project

# ä½¿ç”¨æ•°æ®åº“ä¸Šä¸‹æ–‡
c2rust-agent translate /path/to/c/project --with-db --output ./rust_output

# è¯•è¿è¡Œï¼ˆä»…åˆ†æï¼‰
c2rust-agent analyze /path/to/c/project --dry-run
```

### ç¼–ç¨‹æ¥å£

```rust
use main_processor::{MainProcessor, ProjectInfo, ProjectType};

#[tokio::main]
async fn main() -> Result<()> {
    // åˆå§‹åŒ–å¤„ç†å™¨
    let processor = MainProcessor::new("./cache").await?;
    
    // åˆ›å»ºé¡¹ç›®ä¿¡æ¯
    let project = ProjectInfo {
        name: "my_c_project".to_string(),
        path: "/path/to/c/project".into(),
        project_type: ProjectType::PairedFiles,
    };
    
    // è¿è¡Œç¿»è¯‘
    let stats = processor.run_translation_workflow().await?;
    println!("ç¿»è¯‘å®Œæˆ: {:?}", stats);
    
    Ok(())
}
```

## ç¿»è¯‘æµç¨‹

1. **å‘ç°é˜¶æ®µ**: æ‰«æCé¡¹ç›®ç»“æ„ï¼Œè¯†åˆ«ç¼–è¯‘å•å…ƒ
2. **åˆ†æé˜¶æ®µ**: ä½¿ç”¨LSPæœåŠ¡ç†è§£ä»£ç å…³ç³»å’Œä¾èµ–
3. **ç¼“å­˜é˜¶æ®µ**: é¢„å¤„ç†å™¨åˆ›å»ºä¼˜åŒ–çš„ç¼“å­˜å’Œæ–‡ä»¶æ˜ å°„
4. **ä¸Šä¸‹æ–‡æ„å»º**: ä½¿ç”¨æ•°æ®åº“çŸ¥è¯†ç”Ÿæˆä¸°å¯Œçš„ä¸Šä¸‹æ–‡æç¤º
5. **ç¿»è¯‘é˜¶æ®µ**: LLMåŸºäºè¯­ä¹‰ç†è§£å°†Cä»£ç è½¬æ¢ä¸ºRust
6. **éªŒè¯é˜¶æ®µ**: Rustç¼–è¯‘å™¨æ£€æŸ¥ç”Ÿæˆçš„ä»£ç 
7. **ä¼˜åŒ–é˜¶æ®µ**: å¦‚æœç¼–è¯‘å¤±è´¥ï¼ŒåŸºäºé”™è¯¯åé¦ˆè‡ªåŠ¨é‡è¯•

### æ”¯æŒçš„é¡¹ç›®ç±»å‹

- **å•æ–‡ä»¶**: ç®€å•çš„Cç¨‹åº (main.c â†’ main.rs)
- **é…å¯¹æ–‡ä»¶**: å¤´æ–‡ä»¶/æºæ–‡ä»¶é…å¯¹ (.h/.c â†’ lib.rs + æ¨¡å—)
- **å¤šæ¨¡å—**: åŒ…å«å¤šä¸ªç‹¬ç«‹æ¨¡å—çš„å¤æ‚é¡¹ç›®

### ç¿»è¯‘ç‰¹æ€§

- é€šè¿‡Rustæ‰€æœ‰æƒç³»ç»Ÿå®ç°å†…å­˜å®‰å…¨
- ä½¿ç”¨ `Result<T, E>` ç±»å‹å¤„ç†é”™è¯¯
- å¯¹å¯ç©ºæŒ‡é’ˆæ­£ç¡®ä½¿ç”¨ `Option<T>`
- æƒ¯ç”¨çš„Rustæ¨¡å¼ï¼ˆè¿­ä»£å™¨ã€æ¨¡å¼åŒ¹é…ï¼‰
- åœ¨éœ€è¦æ—¶è‡ªåŠ¨æ·»åŠ  `unsafe` å—æ³¨é‡Š
- ä¸ºCå…¼å®¹ç»“æ„ä½“æ·»åŠ  `#[repr(C)]`

## ç¤ºä¾‹

### è¾“å…¥Cä»£ç 
```c
#include <stdio.h>
#include <stdlib.h>

typedef struct {
    int x, y;
} Point;

Point* create_point(int x, int y) {
    Point* p = malloc(sizeof(Point));
    if (p == NULL) return NULL;
    p->x = x;
    p->y = y;
    return p;
}

void free_point(Point* p) {
    free(p);
}
```

### ç”Ÿæˆçš„Rustä»£ç 
```rust
#[repr(C)]
pub struct Point {
    pub x: i32,
    pub y: i32,
}

impl Point {
    pub fn new(x: i32, y: i32) -> Self {
        Point { x, y }
    }
}

pub fn create_point(x: i32, y: i32) -> Option<Box<Point>> {
    Some(Box::new(Point::new(x, y)))
}

// æ³¨æ„: ä¸éœ€è¦free_point - Rustè‡ªåŠ¨å¤„ç†å†…å­˜ç®¡ç†
```

## å¼€å‘

### é¡¹ç›®ç»“æ„

```
c2rust_agent/
â”œâ”€â”€ crates/
â”‚   â”œâ”€â”€ commandline_tool/     # å‘½ä»¤è¡Œæ¥å£
â”‚   â”œâ”€â”€ cproject_analy/       # Cé¡¹ç›®åˆ†æ
â”‚   â”œâ”€â”€ db_services/          # æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ env_checker/          # ç¯å¢ƒéªŒè¯
â”‚   â”œâ”€â”€ file_scanner/         # æ–‡ä»¶å‘ç°
â”‚   â”œâ”€â”€ llm_requester/        # LLM APIæ¥å£
â”‚   â”œâ”€â”€ lsp_services/         # è¯­è¨€æœåŠ¡å™¨é›†æˆ
â”‚   â”œâ”€â”€ main_processor/       # æ ¸å¿ƒç¿»è¯‘é€»è¾‘
â”‚   â”œâ”€â”€ prompt_builder/       # ä¸Šä¸‹æ–‡æ„ŸçŸ¥æç¤ºç”Ÿæˆ
â”‚   â”œâ”€â”€ rust_checker/         # Rustä»£ç éªŒè¯
â”‚   â””â”€â”€ ui_main/             # å›¾å½¢ç•Œé¢
â”œâ”€â”€ config/                   # é…ç½®æ–‡ä»¶
â”œâ”€â”€ test-projects/           # æµ‹è¯•ç”¨ä¾‹
â””â”€â”€ target/                  # æ„å»ºäº§ç‰©
```

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test

# è¿è¡Œç‰¹å®šåŒ…çš„æµ‹è¯•
cargo test -p main_processor

# å¸¦æ—¥å¿—è¿è¡Œ
RUST_LOG=debug cargo test
```

## è´¡çŒ®

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯: `git checkout -b feature/amazing-feature`
3. æäº¤æ›´æ”¹: `git commit -m 'Add amazing feature'`
4. æ¨é€åˆ°åˆ†æ”¯: `git push origin feature/amazing-feature`
5. å¼€å¯Pull Request

## é™åˆ¶

- ç›®å‰æ”¯æŒC99æ ‡å‡†ï¼ˆC11/C18ç‰¹æ€§å¼€å‘ä¸­ï¼‰
- å¤æ‚å®å¯èƒ½éœ€è¦æ‰‹åŠ¨è°ƒæ•´
- å†…è”æ±‡ç¼–ä¸ä¼šè‡ªåŠ¨ç¿»è¯‘
- æŸäº›å¹³å°ç‰¹å®šä»£ç å¯èƒ½éœ€è¦æ‰‹åŠ¨å®¡æŸ¥

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## è‡´è°¢

- [c2rust](https://github.com/immunant/c2rust) - è½¬è¯‘æ–¹æ³•çš„å¯å‘
- [tree-sitter](https://tree-sitter.github.io/) - ä»£ç è§£ææŠ€æœ¯
- [Qdrant](https://qdrant.tech/) - è¯­ä¹‰æœç´¢å‘é‡æ•°æ®åº“
- Rustç¤¾åŒºæä¾›çš„ä¼˜ç§€å·¥å…·å’Œåº“

## æ”¯æŒ

- ğŸ“– [æ–‡æ¡£](https://github.com/rust4c/c2rust_agent/wiki)
- ğŸ› [é—®é¢˜åé¦ˆ](https://github.com/rust4c/c2rust_agent/issues)
- ğŸ’¬ [è®¨è®ºåŒº](https://github.com/rust4c/c2rust_agent/discussions)
- ğŸ“§ è”ç³»é‚®ç®±: rust4c@example.com

## è·¯çº¿å›¾

- [ ] æ”¯æŒC11/C18æ ‡å‡†
- [ ] æ”¹è¿›å®ç¿»è¯‘
- [ ] æ·»åŠ æ›´å¤šLLMæä¾›å•†æ”¯æŒ
- [ ] å›¾å½¢ç”¨æˆ·ç•Œé¢å®Œå–„
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] å¢é‡ç¿»è¯‘æ”¯æŒ
- [ ] ç¿»è¯‘è´¨é‡è¯„ä¼°å·¥å…·

---

*æœ¬æ–‡æ¡£æŒç»­æ›´æ–°ä¸­ï¼Œå¦‚æœ‰é—®é¢˜è¯·æäº¤Issueæˆ–å‚ä¸Discussionè®¨è®ºã€‚*